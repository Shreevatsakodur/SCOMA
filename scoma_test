rm(list=ls()); graphics.off() 
wd<- setwd("C:/Users/W0038460/ownCloud/SCOMA/APSIM_modelling/R/results")

library(xml2)


# STEP A.create 3 new files for variable 1 viz "init water" using a default APSIM file (called base_file)

# read the base apsim file
base_file <- read_xml("C:/Users/W0038460/ownCloud/SCOMA/APSIM_modelling/scoma_wheat/wheat_test.apsim")
# change the initial water
initial_water <- xml_find_first(base_file, '//InitialWater')
fraction_water <- xml_find_all(initial_water, '//FractionFull')

# create 3 initial water i.e. 1, 0.5 and 0.25. 
int_water_run<-c(1,0.5,0.25)
# run a loop so that it will replaces base value with the new value
for(c in int_water_run){
  for (i in fraction_water) {
    old <- xml_double(fraction_water) 
    new <- c
    xml_text(fraction_water) <- as.character(new)  # Assign new value back into xml document
  }
  dir.create(paste("ini_wat"), showWarnings = FALSE) #create a new directory, to store the outputs
  write_xml(base_file, file.path(paste("ini_wat"), file = paste('initwat_',c,'.apsim', sep="")))
}


# STEP B create 3 new files for variable 2 viz "XF", for all the 3 output files from STEP A

# read the 3 ini water files created from STEP A
setwd("C:/Users/W0038460/ownCloud/SCOMA/APSIM_modelling/R/results/ini_wat")
init_wat_files<-list.files(pattern = ".apsim")

# read the 3 int water files and replace the XF variable values for each of 3 files

# how ???? HERE ONWARDS, I FAIL... help!!!!

for ( m in length(init_wat_files)) {
  read_init_wat_files <- # read the 3 init water xml files! how???? read_xml(init_wat_files)?
    # locate the XF values and replace the 3 XF values viz 0.85,0.35,0.15 for each of 3 init water files
    
    # the below 3 steps should locate the XF value 
    water <- xml_find_first(tags, '//Water')
  SoilCrop <- xml_children(xml_find_first(water, '//SoilCrop'))
  XF <- xml_children(xml_find_first(water, '//XF'))
  
  XF_run<-c(0.85,0.35,0.15) # replace with 3 XF values viz 0.85, 0.35 and 0.15
  # replce the value of XF
  for(d in XF_run){
    for (j in XF) {
      old <- xml_double(XF) 
      new <- d
      # Assign new value back into xml document
      xml_text(XF) <- as.character(new)
    }
    dir.create(paste("XF"), showWarnings = FALSE) #create a new directory called XF to store the XF output files
    write_xml(init_wat_apsim, file.path(paste("XF"), file = paste('initwat_',c,'_XF_',d,'.apsim', sep="")))
  }  
} 


# STEP C: read the 9 outputs (3 init water x 3 XF)

# change the Nitrogen Values

